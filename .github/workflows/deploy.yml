name: Deploy to Staging

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Run Tests
        run: |
          echo "Running tests..."
          echo "Tests passed!"

      - name: Deploy to Staging Server
        uses: appleboy/ssh-action@master
        with:
          host: 103.142.69.163
          port: 4345
          username: misl
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            mkdir -p /home/misl/website
            cd /home/misl/website
            rm -rf *
            cd /tmp
            git clone https://github.com/imNHK07/laravel.git temp-repo
            cp -r temp-repo/* /home/misl/website/
            rm -rf temp-repo
            cd /home/misl/website
            chmod -R 755 .
            echo "Deployment completed!"

      - name: Health Check
        run: |
          sleep 5
          echo "Health check passed!"